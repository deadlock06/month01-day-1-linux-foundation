name: CI

on:
  push:
    branches: [ main ]
  pull_request:

jobs:
  test:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4

      - name: Set up environment
        run: |
          sudo apt-get update && sudo apt-get install -y shellcheck make
          chmod +x src/setup_demo_files.sh scripts/*.sh tests/*.sh

      - name: Prepare data
        run: |
          mkdir -p data backups diagrams
          ./src/setup_demo_files.sh
          ls -R data

      - name: Lint scripts
        run: shellcheck scripts/*.sh src/*.sh tests/*.sh || true

      - name: Run tests
        run: |
          bash tests/validate_permissions.sh
          bash tests/validate_backup.sh

